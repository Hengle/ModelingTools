<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" status="Under Construction" lasteditedby="rbwinst" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">Working with PEST</title>
  <body>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">PEST is a free program by John Doherty for calibrating models. Its theory is documented in </text><link displaytype="text" defaultstyle="true" type="topiclink" href="References_Cited" styleclass="Normal" translate="true">Doherty (2015)</link><text styleclass="Normal" translate="true"> and its usage is documented in its user manual which comes with the program. PEST is available from </text><link displaytype="text" defaultstyle="true" type="weblink" href="https://www.pesthomepage.org" target="_blank" styleclass="Normal" translate="true">www.pesthomepage.org</link><text styleclass="Normal" translate="true">.</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Before starting to work with PEST, you need to have a clear goal for your model. What question do you want your model to answer? What decision do you need to make and how will your model help you make that decision. For example, if a farmer applies for a permit to pump additional groundwater for irrigation, a regulator might use a model to predict how the pumping will affect other users and based on that prediction might grant or deny the permit. A city might want to have a new well to supply drinking water but is concerned about sea water intrusion. A model might be used to help predict the optimal location for the well.</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">For a groundwater model, you also need to have a model that incorporates your understanding of the processes that govern groundwater flow in the area of interest. Gordan Bennett expressed this well. &quot;When you started to have that problem, when you couldn&apos;t get a solution, you could get help with that. You could not get any help if you had a conceptual screw-up in your understanding of the regional hydrology. If you didn&apos;t have a rough idea of what the evapotranspiration was, of what the big streams were doing, and how the stream flow was related to groundwater, there&apos;s where you could get into trouble where nobody else could help you.&quot; (Gordon Bennett in an interview, Feb. 21, 2019.)</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">PEST is used to calibrate a model by varying some of the inputs to the model so that the simulated values generated by the model more closely approach comparable observed values. The hope is that by more closely matching the observations, the model will also make more accurate predictions. PEST will run your model many times during this process. For that reason, it is important that your model run well; it should not terminate prematurely because of problems with the input or because of convergence failure. It is also important that your model not take too long to run. If your model takes to long to run, it may be impractical to calibrate it with PEST. A convenient rule of thumb is that the run time should be less than 30 minutes for parameter estimation with PEST to be practical. However, the larger the number of parameters to be estimated, the longer it will take to calibrate the model and so the shorter the run time needs to be.</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Of course, to match simulated values with observed values, you must have observed values. Head observations are commonly used in calibrating models but head observations alone are typically insufficient to constrain many important model inputs. For example, if your model involves just recharge and specified heads, head observations may allow you to estimate the ratio of the recharge rate to the hydraulic conductivity but will not allow you to estimate the values of either the recharge rate or the hydraulic conductivity independent of one another. For that you need other types of observations such as measurements of flow through the constant head boundaries. It is common for the most important predictions of a groundwater flow model to be predictions of flow. With just head observations, predictions of flow are difficult to make so it is important to have multiple types of observations.</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">If you wish to use PEST with a model, you activate PEST in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Pest_Properties_Basic_Pane" styleclass="Normal" translate="true">Basic Pane</link><text styleclass="Normal" translate="true"> of the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Pest_Properties_Dialog_Box" styleclass="Normal" translate="true">PEST Properties Dialog Box</link><text styleclass="Normal" translate="true">.</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">When PEST is calibrating a model, it does so by changing some of the model inputs. You must decide which model inputs PEST is allowed to vary. You do that by first defining parameters in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Manage_Parameters_Dialog_Box" styleclass="Normal" translate="true">Manage Parameters Dialog Box</link><text styleclass="Normal" translate="true"> or for some MODFLOW packages in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="MODFLOW_Packages_Dialog_Box" styleclass="Normal" translate="true">MODFLOW Packages and Programs Dialog Box</link><text styleclass="Normal" translate="true"> and then using them in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Data_Sets_Dialog_Box" styleclass="Normal" translate="true">Data Sets Dialog Box</link><text styleclass="Normal" translate="true"> or the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Object_Properties_Dialog_Box" styleclass="Normal" translate="true">Object Properties Dialog Box</link><text styleclass="Normal" translate="true">. </text></para>
    <para styleclass="Heading2_atoc_"><text styleclass="Heading2_atoc_" translate="true">Using Parameters with Data Sets</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">For MODFLOW-2005 and related models, parameters can be defined for specific packages using capabilities built directly into MODFLOW. Built-in parameters have been eliminated from MODFLOW 6 but ModelMuse still allows you to use MODFLOW-2005 style parameters for some packages by generating MODFLOW 6 input files based on how parameters would be used with MODFLOW-2005. For SUTRA, MODFLOW 6, MODFLOW-2005 and related models, the user can also define parameters that are unrelated to any package. Their parameter type is identified as &quot;PEST&quot; in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Manage_Parameters_Dialog_Box" styleclass="Normal" translate="true">Manage Parameters Dialog Box</link><text styleclass="Normal" translate="true">. </text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Both MODFLOW-2005 style parameters and PEST parameters can be used with PEST. However, the way that PEST parameters are applied to data sets is somewhat different from how MODFLOW-w005 stype parameters are applied. With MODFLOW-2005 style parameters, the user can define zone and multiplier arrays. If a Zone array is used, the parameter will be applied to cells where the zone array data set is set to true. If a multiplier array is used, the value applied to a cell is the parameter value times the multplier array value. It is possible to have more than one parameter to apply to the same cell of the same data set by setting the zone arrays for two or more parameters to true for the same cell. In that case, the value applied to the cell would be the sum of the values that would be applied by each parameter individually. </text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">If PEST parameters are to be assigned to a data set, select the data set in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Data_Sets_Dialog_Box" styleclass="Normal" translate="true">Data Sets</link><text styleclass="Normal" translate="true"> dialog box and check the </text><text styleclass="Strong" translate="true">PEST Parameters used</text><text styleclass="Normal" translate="true"> checkbox on the PEST Parameters tab. The PEST parameters tab will not be present for all data sets. If it is not present, PEST parameters can not be used with that data set. ModelMuse only allows PEST parameters to be used with real-number data sets. It does not allow PEST parameters to be used with data sets that define the layer structure of the model despite those being real-number data sets. for every data set for which the </text><text styleclass="Strong" translate="true">PEST Parameters used</text><text styleclass="Normal" translate="true"> checkbox is checked, a corresponding text data set will be created when the Apply button in the &#160;is applied. The name of the corresponding data set will be the same as its parent data with with &quot;_Parameter_Names&quot; appended. A PEST parameter will be applied to any cell in the parent data set for which the value of the _Parameter_Names data sets is the same as one of the PEST parameters. The </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Formula_Editor" styleclass="Normal" translate="true">Formula Editor Dialog Box</link><text styleclass="Normal" translate="true"> lists all the PEST parameters and these can be used as the formula for a _Parameter_Names data set either as the default formula in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Data_Sets_Dialog_Box" styleclass="Normal" translate="true">Data Sets</link><text styleclass="Normal" translate="true"> dialog box or in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Data_Sets_Tab" styleclass="Normal" translate="true">Data Sets Tab</link><text styleclass="Normal" translate="true"> of the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Object_Properties_Dialog_Box" styleclass="Normal" translate="true">Object Properties Dialog Box</link><text styleclass="Normal" translate="true">. When a PEST parameter is applied to a cell or element in as data set, the value at that cell or element is multiplied by the parameter value. </text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">A PEST parameter can be associated with pilot points. Candidate pilot point locations are defined in the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Pest_Properties_Pilot_Points_P" styleclass="Normal" translate="true">Pilot Points Pane</link><text styleclass="Normal" translate="true"> of the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Pest_Properties_Dialog_Box" styleclass="Normal" translate="true">PEST Properties Dialog Box</link><text styleclass="Normal" translate="true">. Whether or not a particular parameter is associated with pilot points is specified ion the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Manage_Parameters_Dialog_Box" styleclass="Normal" translate="true">Manage Parameters Dialog Box</link><text styleclass="Normal" translate="true">. If pilot points are with a parameter, the treatment of the parameter is somewhat modified while PEST is running. Instead of multiplying the data set value by the parameter value, each pilot point will be an independent parameter. The PEST utility program PLPROC will be used to interpolate among the pilot point values and the interpolated values will be assigned to the data set wherever the parent parameter is used. The pilot points used with a particular parameter for a particular data set will be any of the candidate pilot points defined on the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Pest_Properties_Pilot_Points_P" styleclass="Normal" translate="true">Pilot Points Pane</link><text styleclass="Normal" translate="true"> of the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Pest_Properties_Dialog_Box" styleclass="Normal" translate="true">PEST Properties Dialog Box</link><text styleclass="Normal" translate="true"> that is no further away then the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="Pest_Properties_Pilot_Points_P" styleclass="Strong" translate="true">Pilot point buffer</link><text styleclass="Normal" translate="true"> from a cell center (MODFLOW) or node location or element center (SUTRA) that is part of the zone where the parameter applies. The initial value assigned to a pilot point will be the value at the data set in ModelMuse. However, if the parent parameter for a pilot point is not used for the pilot point location, the nearest location for which it is used will supply the initial value for the pilot point.</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">To clarify matters, lets look at a simple model with 10 rows, 10 columns, and 1 &#160;layer. The rows and columns have a spacing of 100 meters The model has two parameters defined - KLeft and KRight as illustrated below. They will be used to define the hydraulic conductivity in the X direction on the left and right sides of the model respectively. Both parameters have initial values of 1. Pilot points are used with KRight but not with KLeft. </text></para>
    <para styleclass="Normal"><image src="PestParamDefinition.png" scale="100.00%" styleclass="Image Caption"><title translate="true">Screen capture of the Manage Parameters dialog box with two parameters defined.</title><caption translate="true"><![CDATA[Screen capture of the Manage Parameters dialog box with two parameters defined.]]></caption></image></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">There are 25 candidate pilot points defined as illustrated below which are spaced 200 meters apart. Nine of the pilot points are outside the model grid. </text></para>
    <para styleclass="Normal"><image src="ExampleCandidatePilotPoints.png" scale="100.00%" styleclass="Image Caption"><title translate="true">Screen capture illustrating the locations of the candidate pilot points</title><caption translate="true"><![CDATA[Screen capture illustrating the locations of the candidate pilot points]]></caption></image></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The pilot point buffer in this model is 290 m. Because the leftmost column of pilot points is more than 290 meters from the center of any cell in the right half of the model (where pilot points are applied) that column of pilot points will not be used.On the other hand, the pilot points above and to the right of the grid (except the one in the first column) are within the pilot point buffer and will be used. Their initial values will come from the cell to which each of them is closest. </text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">The model also has some boundary conditions and observations but we won&apos;t describe those here.</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">After PEST has finished running, we can view the values assigned to the Kx data set using &quot;File|Import|Gridded Data Files...&quot; We can select the file containing the final values in the &quot;arrays&quot; subdirectory of the directory in which the model ran. The file will have the extension &quot;.arrays.&quot; The final distribution of Kx is shown below. Note that the left half of the model where no pilot points were used has a uniform distribution of Kx values whereas in the right half where pilot points were used, the hydraulic conductivity varies among the cells.</text></para>
    <para styleclass="Normal"><image src="PestExamplePilotPoints.png" scale="100.00%" styleclass="Image Caption"><title translate="true">Diagram showing distribution of Kx values after PEST estimates parameters.</title><caption translate="true"><![CDATA[Diagram showing distribution of Kx values after PEST estimates parameters.]]></caption></image></para>
  </body>
</topic>
